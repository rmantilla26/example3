<html>
  <title>this is a sercret chat test</title>
  <link REL=StyleSheet HREF="jquery/css/custom-theme/jquery-ui-1.8.14.custom.css" type="text/css" >
  <script src="jquery/js/jquery-1.5.1.min.js" type="text/javascript" ></script> 
  <script src="jquery/js/jquery-ui-1.8.14.custom.min.js" type="text/javascript"></script>
  <style>
    .chat { width: 650px; height: 250px; padding: 0.5em; overflow: hidden; }
    .chat h3 { text-align: center; margin: 0; font-family:  sans-serif; }
    .chat .messagesCHAT {  float: left; width: 70%; height: 80%; padding: 0; margin: 0; overflow: auto; }
    .chat .membersCHAT {  float: right; width: 28%; height: 80%; padding: 0; margin: 0;  overflow: auto;}
    .chat .membersCHAT ul {  padding: 10 10; margin: 0; }

  </style>
  <script type="text/javascript" >
    $(document).ready(function(){
      $.ajaxSetup({ cache: false });

      $('.send').click(function() {
        send_message()
      });
      
      $('.form').submit(function() {
        send_message()
        return false;
      });
    
    });
    
    function load_chat(){
      $.getJSON("/load_chat?chatID="+$('#chatID').val()+"&userID="+$('#userID').val(),function(json){
        $("#members").empty();
        $.each(json.members,function(i,member){
          
          $("#members").append($("<option />").val(member.id).text(member.name));
         
        });
        $.each(json.messages,function(i,msg){
          
          if($('#'+i).length==0){
            $("#messages").append("<li id='"+i+"'>"+msg.message+"</li>");
          }
        });
      });
    }
    
    function send_message(){
      var url_send = "/send_message?chatID="+$('#chatID').val()+"&userID="+$('#userID').val()+"&message="+$('#message').val()
      $.ajax({
        url: url_send,
        success: function(id){
          $("#messages").append("<li id='"+id+"'>"+$('#message').val()+"</li>");
          $("#message").val("");
        }
      });
    }
    
    $(function() {
      //$( ".chat" ).draggable().resizable();
      $( ".chat" ).dialog({  width: 560,height: 300 , closeOnEscape: true });
    });
    
    
    
    
    
  </script>
  <body onload="setInterval('load_chat()', 5000);"  >
    <div class="chat" title="<%=@chatID%>" >
      <form class="form" >
        <input type="hidden" id="lastmessageID" name="lastmessageID" value="0"/>
        <input type="hidden" id="userID" name="userID" value="<%=@userID%>"/>
        <input type="hidden" id="chatID" name="chatID" value="<%=@chatID%>"/>
        <div class="messagesCHAT ui-widget-content" >
          <ul id="messages"></ul>
        </div>
        <div class="membersCHAT ui-widget-content" >
          <ul id="members"></ul>
        </div>
        <div class="inputCHAT ui-widget-content" >
          <input type="text" id="message" class="ui-widget-content" name="message" size="50">
          <input type="button" class="send ui-state-highlight" value="Send" >
        </div>
      </form>
    </div>



  </body>

</html>
